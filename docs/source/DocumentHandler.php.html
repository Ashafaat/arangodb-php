<html>
    <head>
        <script
            type="text/javascript"
            src="../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php

/**
 * ArangoDB PHP client: document handler
 *
 * @package   triagens\ArangoDb
 * @author    Jan Steemann
 * @author    Frank Mayer
 * @copyright Copyright 2012, triagens GmbH, Cologne, Germany
 */

namespace triagens\ArangoDb;


/**
 * A document handler that fetches documents from the server and
 * persists them on the server. It does so by issuing the
 * appropriate HTTP requests to the server.
 *
 * @package triagens\ArangoDb
 */
class DocumentHandler extends
    Handler
{
    /**
     * documents array index
     */
    const ENTRY_DOCUMENTS = 'documents';

    /**
     * collection parameter
     */
    const OPTION_COLLECTION = 'collection';

    /**
     * example parameter
     */
    const OPTION_EXAMPLE = 'example';


    /**
     * Get a single document from a collection
     *
     * Alias method for getById()
     *
     * @throws Exception
     *
     * @param mixed $collectionId - collection id as a string or number
     * @param mixed $documentId   - document identifier
     * @param array $options      - optional, array of options
     * &lt;p&gt;Options are :
     * &lt;li&gt;'_includeInternals' - true to include the internal attributes. Defaults to false&lt;/li&gt;
     * &lt;li&gt;'includeInternals' - Deprecated, please use '_includeInternals'.&lt;/li&gt;
     * &lt;li&gt;'_ignoreHiddenAttributes' - true to show hidden attributes. Defaults to false&lt;/li&gt;
     * &lt;li&gt;'ignoreHiddenAttributes' - Deprecated, please use '_ignoreHiddenAttributes'.&lt;/li&gt;
     * &lt;/p&gt;
     *
     * @return Document - the document fetched from the server
     */
    public function get($collectionId, $documentId, array $options = array())
    {
        return $this-&gt;getById($collectionId, $documentId, $options);
    }


    /**
     * Get a single document from a collection
     *
     * This will throw if the document cannot be fetched from the server
     *
     * @throws Exception
     *
     * @param mixed $collectionId - collection id as a string or number
     * @param mixed $documentId   - document identifier
     * @param array $options      - optional, array of options
     * &lt;p&gt;Options are :
     * &lt;li&gt;'_includeInternals' - true to include the internal attributes. Defaults to false&lt;/li&gt;
     * &lt;li&gt;'includeInternals' - Deprecated, please use '_includeInternals'.&lt;/li&gt;
     * &lt;li&gt;'_ignoreHiddenAttributes' - true to show hidden attributes. Defaults to false&lt;/li&gt;
     * &lt;li&gt;'ignoreHiddenAttributes' - Deprecated, please use '_ignoreHiddenAttributes'.&lt;/li&gt;
     * &lt;/p&gt;
     *
     * @return Document - the document fetched from the server
     */
    public function getById($collectionId, $documentId, array $options = array())
    {
        $url      = UrlHelper::buildUrl(Urls::URL_DOCUMENT, array($collectionId, $documentId));
        $response = $this-&gt;getConnection()-&gt;get($url);

        $data = $response-&gt;getJson();

        $options['_isNew'] = false;

        return $this-&gt;createFromArrayWithContext($data, $options);
    }


    /**
     * Intermediate function to call the createFromArray function from the right context
     *
     * @param $data
     * @param $options
     *
     * @return Document
     */
    protected function createFromArrayWithContext($data, $options)
    {
        return Document::createFromArray($data, $options);
    }


    /**
     * Get the list of all documents' ids from a collection
     *
     * This will throw if the list cannot be fetched from the server
     *
     * @throws Exception
     *
     * @param mixed $collectionId - collection id as string or number
     *
     * @return array - ids of documents in the collection
     *
     * @deprecated to be removed in version 2.0 - This function is being replaced by  CollectionHandler::getAllIds()
     *
     */
    public function getAllIds($collectionId)
    {
        $collectionHandler = new CollectionHandler($this-&gt;getConnection());

        return $collectionHandler-&gt;getAllIds($collectionId);
    }


    /**
     * Get document(s) by specifying an example
     *
     * This will throw if the list cannot be fetched from the server
     *
     *
     * @throws Exception
     *
     * @param mixed      $collectionId - collection id as string or number
     * @param mixed      $document     - the example document as a Document object or an array
     * @param bool|array $options      - optional, prior to v1.0.0 this was a boolean value for sanitize, since v1.0.0 it's an array of options.
     * &lt;p&gt;Options are :&lt;br&gt;
     * &lt;li&gt;'_sanitize' - True to remove _id and _rev attributes from result documents. Defaults to false.&lt;/li&gt;
     * &lt;li&gt;'sanitize' - Deprecated, please use '_sanitize'.&lt;/li&gt;
     * &lt;li&gt;'_hiddenAttributes' - Set an array of hidden attributes for created documents.
     * &lt;li&gt;'hiddenAttributes' - Deprecated, please use '_hiddenAttributes'.&lt;/li&gt;
     * &lt;p&gt;
     *                                 This is actually the same as setting hidden attributes using setHiddenAttributes() on a document. &lt;br&gt;
     *                                 The difference is, that if you're returning a resultset of documents, the getAll() is already called &lt;br&gt;
     *                                 and the hidden attributes would not be applied to the attributes.&lt;br&gt;
     * &lt;/p&gt;
     * &lt;/li&gt;
     * &lt;li&gt;'batchSize' - can optionally be used to tell the server to limit the number of results to be transferred in one batch&lt;/li&gt;
     * &lt;li&gt;'skip' -  Optional, The number of documents to skip in the query.&lt;/li&gt;
     * &lt;li&gt;'limit' -  Optional, The maximal amount of documents to return. 'skip' is applied before the limit restriction.&lt;/li&gt;
     * &lt;/p&gt;
     *
     * @return cursor - Returns a cursor containing the result
     *
     * @deprecated to be removed in version 2.0 - This function is being replaced by CollectionHandler::byExample()
     */
    public function getByExample($collectionId, $document, $options = false)
    {
        $collectionHandler = new CollectionHandler($this-&gt;getConnection());

        return $collectionHandler-&gt;byExample($collectionId, $document, $options);
    }


    /**
     * Add a document to a collection
     *
     * This will add the document to the collection and return the document's id
     *
     * This will throw if the document cannot be created
     *
     * @throws Exception
     *
     * @param mixed      $collectionId - collection id as string or number
     * @param Document   $document     - the document to be added
     * @param bool|array $options      - optional, prior to v1.2.0 this was a boolean value for create. Since v1.0.0 it's an array of options.
     * &lt;p&gt;Options are :&lt;br&gt;
     * &lt;li&gt;'create' - create the collection if it does not yet exist.&lt;/li&gt;
     * &lt;li&gt;'waitForSync' -  if set to true, then all removal operations will instantly be synchronised to disk / If this is not specified, then the collection's default sync behavior will be applied.&lt;/li&gt;
     * &lt;/p&gt;
     *
     * @return mixed - id of document created
     *
     * @deprecated to be removed in version 2.0 - This function is being replaced by save()
     *
     */

    public function add($collectionId, Document $document, $options = array())
    {
        return $this-&gt;save($collectionId, $document, $options);
    }

    /**
     * Store a document to a collection
     *
     * This is an alias/shortcut to save() and replace(). Instead of having to determine which of the 3 functions to use,
     * simply pass the document to store() and it will figure out which one to call.
     *
     * This will throw if the document cannot be saved or replaced.
     *
     * @throws Exception
     *
     * @param Document   $document       - the document to be added, can be passed as a document or an array
     * @param mixed      $collectionId   - collection id as string or number
     * @param bool|array $options        - optional, prior to v1.2.0 this was a boolean value for create. Since v1.2.0 it's an array of options.
     * &lt;p&gt;Options are :&lt;br&gt;
     * &lt;li&gt;'create' - create the collection if it does not yet exist.&lt;/li&gt;
     * &lt;li&gt;'waitForSync' -  if set to true, then all removal operations will instantly be synchronised to disk / If this is not specified, then the collection's default sync behavior will be applied.&lt;/li&gt;
     * &lt;/p&gt;
     *
     * @return mixed - id of document created
     * @since 1.0
     */
    public function store(Document $document, $collectionId = null, $options = array())
    {
        if ($document-&gt;getIsNew()) {

            if ($collectionId == null) {
                throw new ClientException('A collection id is required to store a new document.');
            }

            $result = $this-&gt;save($collectionId, $document, $options);
            $document-&gt;setIsNew(false);

            return $result;
        } else {

            if ($collectionId) {
                throw new ClientException('An existing document cannot be stored into a new collection');
            }

            return $this-&gt;replace($document, $options);
        }
    }


    /**
     * save a document to a collection
     *
     * This will add the document to the collection and return the document's id
     *
     * This will throw if the document cannot be saved
     *
     * @throws Exception
     *
     * @param mixed      $collectionId - collection id as string or number
     * @param mixed      $document     - the document to be added, can be passed as a document or an array
     * @param bool|array $options      - optional, prior to v1.2.0 this was a boolean value for create. Since v1.0.0 it's an array of options.
     * &lt;p&gt;Options are :&lt;br&gt;
     * &lt;li&gt;'create' - create the collection if it does not yet exist.&lt;/li&gt;
     * &lt;li&gt;'waitForSync' -  if set to true, then all removal operations will instantly be synchronised to disk / If this is not specified, then the collection's default sync behavior will be applied.&lt;/li&gt;
     * &lt;/p&gt;
     *
     * @return mixed - id of document created
     * @since 1.0
     */
    public function save($collectionId, $document, $options = array())
    {
        // This preserves compatibility for the old create parameter.
        $params = array(self::OPTION_COLLECTION =&gt; $collectionId);
        $params = $this-&gt;validateAndIncludeOldSingleParameterInParams(
            $options,
            $params,
            ConnectionOptions::OPTION_CREATE
        );

        $params = $this-&gt;includeOptionsInParams(
            $options,
            $params,
            array(
                 ConnectionOptions::OPTION_WAIT_SYNC =&gt; $this-&gt;getConnectionOption(ConnectionOptions::OPTION_WAIT_SYNC),
            )
        );

        if (is_array($document)) {
            $document = Document::createFromArray($document);
        }
        $data = $document-&gt;getAll();

        $url = UrlHelper::appendParamsUrl(Urls::URL_DOCUMENT, $params);

        $response = $this-&gt;getConnection()-&gt;post($url, $this-&gt;json_encode_wrapper($data));

        $location = $response-&gt;getLocationHeader();
        if (!$location) {
            throw new ClientException('Did not find location header in server response');
        }

        $json = $response-&gt;getJson();
        $id   = UrlHelper::getDocumentIdFromLocation($location);

        $document-&gt;setInternalId($json[Document::ENTRY_ID]);
        $document-&gt;setRevision($json[Document::ENTRY_REV]);

        if ($id != $document-&gt;getId()) {
            throw new ClientException('Got an invalid response from the server');
        }

        $document-&gt;setIsNew(false);

        return $document-&gt;getId();
    }


    /**
     * Update an existing document in a collection, identified by the including _id and optionally _rev in the patch document.
     * Attention - The behavior of this method has changed since version 1.1
     *
     * This will update the document on the server
     *
     * This will throw if the document cannot be updated
     *
     * If policy is set to error (locally or globally through the ConnectionOptions)
     * and the passed document has a _rev value set, the database will check
     * that the revision of the document to-be-replaced is the same as the one given.
     *
     * @throws Exception
     *
     * @param Document $document - The patch document that will update the document in question
     * @param mixed    $options  - optional, array of options (see below) or the boolean value for $policy (for compatibility prior to version 1.1 of this method)
     * &lt;p&gt;Options are :
     * &lt;li&gt;'policy' - update policy to be used in case of conflict ('error', 'last' or NULL [use default])&lt;/li&gt;
     * &lt;li&gt;'keepNull' - can be used to instruct ArangoDB to delete existing attributes instead setting their values to null. Defaults to true (keep attributes when set to null)&lt;/li&gt;
     * &lt;li&gt;'waitForSync' - can be used to force synchronisation of the document update operation to disk even in case that the waitForSync flag had been disabled for the entire collection&lt;/li&gt;
     * &lt;/p&gt;
     *
     * @return bool - always true, will throw if there is an error
     */
    public function update(Document $document, $options = array())
    {
        $collectionId = $this-&gt;getCollectionId($document);
        $documentId   = $this-&gt;getDocumentId($document);

        return $this-&gt;updateById($collectionId, $documentId, $document, $options);
    }


    /**
     * Update an existing document in a collection, identified by collection id and document id
     * Attention - The behavior of this method has changed since version 1.1
     *
     * This will update the document on the server
     *
     * This will throw if the document cannot be updated
     *
     * If policy is set to error (locally or globally through the ConnectionOptions)
     * and the passed document has a _rev value set, the database will check
     * that the revision of the document to-be-updated is the same as the one given.
     *
     * @throws Exception
     *
     * @param mixed    $collectionId - collection id as string or number
     * @param mixed    $documentId   - document id as string or number
     * @param Document $document     - patch document which contains the attributes and values to be updated
     * @param mixed    $options      - optional, array of options (see below) or the boolean value for $policy (for compatibility prior to version 1.1 of this method)
     * &lt;p&gt;Options are :
     * &lt;li&gt;'policy' - update policy to be used in case of conflict ('error', 'last' or NULL [use default])&lt;/li&gt;
     * &lt;li&gt;'keepNull' - can be used to instruct ArangoDB to delete existing attributes instead setting their values to null. Defaults to true (keep attributes when set to null)&lt;/li&gt;
     * &lt;li&gt;'waitForSync' - can be used to force synchronisation of the document update operation to disk even in case that the waitForSync flag had been disabled for the entire collection&lt;/li&gt;
     * &lt;/p&gt;
     *
     * @return bool - always true, will throw if there is an error
     */
    public function updateById($collectionId, $documentId, Document $document, $options = array())
    {
        // This preserves compatibility for the old policy parameter.
        $params = array();
        $params = $this-&gt;validateAndIncludeOldSingleParameterInParams(
            $options,
            $params,
            ConnectionOptions::OPTION_UPDATE_POLICY
        );
        $params = $this-&gt;includeOptionsInParams(
            $options,
            $params,
            array(
                 'waitForSync' =&gt; $this-&gt;getConnectionOption(ConnectionOptions::OPTION_WAIT_SYNC),
                 'keepNull'    =&gt; true,
            )
        );

        $revision = $document-&gt;getRevision();
        if (!is_null($revision)) {
            $params[ConnectionOptions::OPTION_REVISION] = $revision;
        }

        $url    = UrlHelper::buildUrl(Urls::URL_DOCUMENT, array($collectionId, $documentId));
        $url    = UrlHelper::appendParamsUrl($url, $params);
        $result = $this-&gt;getConnection()-&gt;patch($url, $this-&gt;json_encode_wrapper($document-&gt;getAll()));
        $json   = $result-&gt;getJson();
        $document-&gt;setRevision($json[Document::ENTRY_REV]);

        return true;
    }


    /**
     * Replace an existing document in a collection, identified by the document itself
     *
     * This will update the document on the server
     *
     * This will throw if the document cannot be updated
     *
     * If policy is set to error (locally or globally through the ConnectionOptions)
     * and the passed document has a _rev value set, the database will check
     * that the revision of the to-be-replaced document is the same as the one given.
     *
     * @throws Exception
     *
     * @param Document $document - document to be updated
     * @param mixed    $options  - optional, array of options (see below) or the boolean value for $policy (for compatibility prior to version 1.1 of this method)
     * &lt;p&gt;Options are :
     * &lt;li&gt;'policy' - update policy to be used in case of conflict ('error', 'last' or NULL [use default])&lt;/li&gt;
     * &lt;li&gt;'waitForSync' - can be used to force synchronisation of the document update operation to disk even in case that the waitForSync flag had been disabled for the entire collection&lt;/li&gt;
     * &lt;/p&gt;
     *
     * @return bool - always true, will throw if there is an error
     */
    public function replace(Document $document, $options = array())
    {
        $collectionId = $this-&gt;getCollectionId($document);
        $documentId   = $this-&gt;getDocumentId($document);

        return $this-&gt;replaceById($collectionId, $documentId, $document, $options);
    }


    /**
     * Replace an existing document in a collection, identified by collection id and document id
     *
     * This will update the document on the server
     *
     * This will throw if the document cannot be Replaced
     *
     * If policy is set to error (locally or globally through the ConnectionOptions)
     * and the passed document has a _rev value set, the database will check
     * that the revision of the to-be-replaced document is the same as the one given.
     *
     * @throws Exception
     *
     * @param mixed    $collectionId - collection id as string or number
     * @param mixed    $documentId   - document id as string or number
     * @param Document $document     - document to be updated
     * @param mixed    $options      - optional, array of options (see below) or the boolean value for $policy (for compatibility prior to version 1.1 of this method)
     * &lt;p&gt;Options are :
     * &lt;li&gt;'policy' - update policy to be used in case of conflict ('error', 'last' or NULL [use default])&lt;/li&gt;
     * &lt;li&gt;'waitForSync' - can be used to force synchronisation of the document replacement operation to disk even in case that the waitForSync flag had been disabled for the entire collection&lt;/li&gt;
     * &lt;/p&gt;
     *
     * @return bool - always true, will throw if there is an error
     */
    public function replaceById($collectionId, $documentId, Document $document, $options = array())
    {
        // This preserves compatibility for the old policy parameter.
        $params = array();
        $params = $this-&gt;validateAndIncludeOldSingleParameterInParams(
            $options,
            $params,
            ConnectionOptions::OPTION_REPLACE_POLICY
        );
        $params = $this-&gt;includeOptionsInParams(
            $options,
            $params,
            array('waitForSync' =&gt; ConnectionOptions::OPTION_WAIT_SYNC)
        );

        $revision = $document-&gt;getRevision();
        if (!is_null($revision)) {
            $params[ConnectionOptions::OPTION_REVISION] = $revision;
        }

        $data   = $document-&gt;getAll();
        $url    = UrlHelper::buildUrl(Urls::URL_DOCUMENT, array($collectionId, $documentId));
        $url    = UrlHelper::appendParamsUrl($url, $params);
        $result = $this-&gt;getConnection()-&gt;put($url, $this-&gt;json_encode_wrapper($data));
        $json   = $result-&gt;getJson();
        $document-&gt;setRevision($json[Document::ENTRY_REV]);

        return true;
    }


    /**
     * Delete a document from a collection, identified by the document itself
     *
     * @throws Exception
     *
     * @param Document $document - document to be updated
     * @param mixed    $options  - optional, array of options (see below) or the boolean value for $policy (for compatibility prior to version 1.1 of this method)
     * &lt;p&gt;Options are :
     * &lt;li&gt;'policy' - update policy to be used in case of conflict ('error', 'last' or NULL [use default])&lt;/li&gt;
     * &lt;li&gt;'waitForSync' - can be used to force synchronisation of the document replacement operation to disk even in case that the waitForSync flag had been disabled for the entire collection&lt;/li&gt;
     * &lt;/p&gt;
     *
     * @return bool - always true, will throw if there is an error
     *
     * @deprecated to be removed in version 2.0 - This function is being replaced by remove()
     *
     */
    public function delete(Document $document, $options = array())
    {
        return $this-&gt;remove($document, $options);
    }


    /**
     * Remove a document from a collection, identified by the document itself
     *
     * @throws Exception
     *
     * @param Document $document - document to be removed
     * @param mixed    $options  - optional, array of options (see below) or the boolean value for $policy (for compatibility prior to version 1.1 of this method)
     * &lt;p&gt;Options are :
     * &lt;li&gt;'policy' - update policy to be used in case of conflict ('error', 'last' or NULL [use default])&lt;/li&gt;
     * &lt;li&gt;'waitForSync' - can be used to force synchronisation of the document removal operation to disk even in case that the waitForSync flag had been disabled for the entire collection&lt;/li&gt;
     * &lt;/p&gt;
     *
     * @return bool - always true, will throw if there is an error
     */
    public function remove(Document $document, $options = array())
    {
        $collectionId = $this-&gt;getCollectionId($document);
        $documentId   = $this-&gt;getDocumentId($document);

        $revision = $this-&gt;getRevision($document);

        return $this-&gt;deleteById($collectionId, $documentId, $revision, $options);
    }


    /**
     * Delete a document from a collection, identified by the collection id and document id
     *
     * @throws Exception
     *
     * @param mixed  $collectionId - collection id as string or number
     * @param mixed  $documentId   - document id as string or number
     * @param  mixed $revision     - optional revision of the document to be deleted
     * @param mixed  $options      - optional, array of options (see below) or the boolean value for $policy (for compatibility prior to version 1.1 of this method)
     * &lt;p&gt;Options are :
     * &lt;li&gt;'policy' - update policy to be used in case of conflict ('error', 'last' or NULL [use default])&lt;/li&gt;
     * &lt;li&gt;'waitForSync' - can be used to force synchronisation of the document replacement operation to disk even in case that the waitForSync flag had been disabled for the entire collection&lt;/li&gt;
     * &lt;/p&gt;
     *
     * @return bool - always true, will throw if there is an error
     *
     * @deprecated to be removed in version 2.0 - This function is being replaced by removeById()
     */
    public function deleteById($collectionId, $documentId, $revision = null, $options = array())
    {
        $this-&gt;removeById($collectionId, $documentId, $revision, $options);

        return true;
    }


    /**
     * Remove a document from a collection, identified by the collection id and document id
     *
     * @throws |Exception
     *
     * @param mixed  $collectionId - collection id as string or number
     * @param mixed  $documentId   - document id as string or number
     * @param  mixed $revision     - optional revision of the document to be deleted
     * @param mixed  $options      - optional, array of options (see below) or the boolean value for $policy (for compatibility prior to version 1.1 of this method)
     * &lt;p&gt;Options are :
     * &lt;li&gt;'policy' - update policy to be used in case of conflict ('error', 'last' or NULL [use default])&lt;/li&gt;
     * &lt;li&gt;'waitForSync' - can be used to force synchronisation of the document removal operation to disk even in case that the waitForSync flag had been disabled for the entire collection&lt;/li&gt;
     * &lt;/p&gt;
     *
     * @return bool - always true, will throw if there is an error
     */
    public function removeById($collectionId, $documentId, $revision = null, $options = array())
    {
        // This preserves compatibility for the old policy parameter.
        $params = array();
        $params = $this-&gt;validateAndIncludeOldSingleParameterInParams(
            $options,
            $params,
            ConnectionOptions::OPTION_DELETE_POLICY
        );
        $params = $this-&gt;includeOptionsInParams(
            $options,
            $params,
            array('waitForSync' =&gt; ConnectionOptions::OPTION_WAIT_SYNC)
        );

        if (!is_null($revision)) {
            $params[ConnectionOptions::OPTION_REVISION] = $revision;
        }

        $url = UrlHelper::buildUrl(Urls::URL_DOCUMENT, array($collectionId, $documentId));
        $url = UrlHelper::appendParamsUrl($url, $params);
        $this-&gt;getConnection()-&gt;delete($url);

        return true;
    }


    /**
     * Helper function to get a document id from a document or a document id value
     *
     * @throws ClientException
     *
     * @param mixed $document - document id OR document to be updated
     *
     * @return mixed - document id, will throw if there is an error
     */
    private function getDocumentId($document)
    {
        if ($document instanceof Document) {
            $documentId = $document-&gt;getId();
        } else {
            $documentId = $document;
        }

        if (!$documentId || !(is_string($documentId) || is_double($documentId) || is_int($documentId))) {
            throw new ClientException('Cannot alter a document without a document id');
        }

        return $documentId;
    }


    /**
     * Helper function to get a document id from a document or a document id value
     *
     * @throws ClientException
     *
     * @param mixed $document - document id OR document to be updated
     *
     * @return mixed - document id, will throw if there is an error
     */
    private function getRevision($document)
    {
        if ($document instanceof Document) {
            $revision = $document-&gt;getRevision();
        } else {
            $revision = null;
        }

        return $revision;
    }


    /**
     * Helper function to get a collection id from a document
     *
     * @throws ClientException
     *
     * @param Document $document - document id
     *
     * @return mixed - collection id, will throw if there is an error
     */
    private function getCollectionId(Document $document)
    {
        $collectionId = $document-&gt;getCollectionId();

        if (!$collectionId || !(is_string($collectionId) || is_double($collectionId) || is_int($collectionId))) {
            throw new ClientException('Cannot alter a document without a document id');
        }

        return $collectionId;
    }
}
</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all()
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>